export MALLOC_CHECK_=2
export SC_LOG_DIR=/tmp
export SC_LOG_LEVEL=5
export MDIRD_HOST=scambio.happyleptic.org
export MDIRD_PORT=21654
export SC_FILED_HOST=scambio.happyleptic.org
export SC_FILED_PORT=21436
export SC_SMTPD_PORT=1025
#export SC_RUNASUSER=scambio
#export SC_RUNASGROUP=scambio

function auth_user {
	dir=$1
	name=$2
	cat > $dir/$name <<EOF
key: 1234567890DEADBEAF
method: 3des

EOF
}

function auth_users {
	mkdir -p $MDIR_USERS_DIR
	auth_user $MDIR_USERS_DIR Alice
	auth_user $MDIR_USERS_DIR Bob
}

function send_content {
	nc $MDIRD_HOST $MDIRD_PORT <<EOF
1 auth Alice
2 put /
sc-type: dir
sc-name: mailboxes

3 put /mailboxes
sc-type: dir
sc-name: Incoming

4 put /mailboxes
sc-type: dir
sc-name: To Send

5 put /mailboxes
sc-type: dir
sc-name: Sent

6 put /
sc-type: dir
sc-name: calendars

7 put mailboxes/Incoming
sc-type: dir
sc-name: rixed@dangi.happyleptic.org

8 put calendars
sc-type: dir
sc-name: rixed

9 put calendars
sc-type: dir
sc-name: project-X

10 put calendars/rixed
sc-start: 2008 10 21 12 00
sc-stop:  2008 10 21 13 00
sc-descr: lunch time

11 put calendars/rixed
sc-start: 2008 10 21 15 00
sc-stop:  2008 10 21 15 30
sc-descr: meeting prod

12 put calendars/rixed
sc-start: 2008 10 21 15 30
sc-stop:  2008 10 21 16 00
sc-descr: meeting support

13 put calendars/rixed
sc-start: 2008 10 25 12 00
sc-stop:  2008 10 26 12 00
sc-descr: PACS Ramine et Sandron

13 put /
sc-type: dir
sc-name: files

14 put /
sc-type: dir
sc-name: contacts

999 quit
EOF
}

function send_email {
	nc scambio.happyleptic.org $SC_SMTPD_PORT < smtpd/check/multipart
}

ulimit -c unlimited
